# ğŸŠ orange-translator

EPUB åŒè¯­ç¿»è¯‘å·¥å…·ï¼Œä½¿ç”¨å¤§æ¨¡å‹å°†ç”µå­ä¹¦ç¿»è¯‘ä¸ºç›®æ ‡è¯­è¨€ï¼Œè¯‘æ–‡ç´§è·ŸåŸæ–‡æ®µè½ä¹‹åï¼Œç”ŸæˆåŒè¯­ EPUBã€‚

## ç‰¹æ€§

- **åŒè¯­æ’ç‰ˆ**ï¼šè¯‘æ–‡ç´§è·ŸåŸæ–‡æ®µè½ï¼Œä¿ç•™åŸæœ‰å—çº§ HTML ç»“æ„ä¸æ ·å¼ï¼ˆå«å±…ä¸­ã€åŠ ç²—ç­‰ï¼‰
- **é«˜è´¨é‡ç¿»è¯‘**ï¼šé¢„å¤„ç†é˜¶æ®µå‰¥ç¦»è£…é¥°æ€§å†…è”æ ‡ç­¾ï¼Œè®© LLM çœ‹åˆ°æ¥è¿‘çº¯æ–‡æœ¬çš„è¾“å…¥ï¼Œç¿»è¯‘æ›´è‡ªç„¶
- **æœ¬åœ°ä¼˜å…ˆ**ï¼šé»˜è®¤ä½¿ç”¨ [Ollama](https://ollama.com) æœ¬åœ°å¤§æ¨¡å‹ï¼ˆ`translategemma:4b`ï¼‰ï¼Œæ— éœ€è”ç½‘
- **å¯æ‰©å±•å¼•æ“**ï¼šæ”¯æŒä»»æ„ OpenAI å…¼å®¹æ¥å£ï¼ˆDeepSeekã€ç¡…åŸºæµåŠ¨ç­‰ï¼‰
- **ä»»æ„è¯­è¨€å¯¹**ï¼šä¸é™ç¿»è¯‘æ–¹å‘ï¼Œæ”¯æŒ 17 ç§å¸¸ç”¨è¯­è¨€
- **ç»­ç¿»æ”¯æŒ**ï¼šç« èŠ‚çº§ç£ç›˜ç¼“å­˜ï¼Œä¸­æ–­åè‡ªåŠ¨è·³è¿‡å·²å®Œæˆç« èŠ‚ï¼Œæ”¯æŒå¤§éƒ¨å¤´ä¹¦ç±åˆ†å¤šæ¬¡ç¿»è¯‘
- **åŒå…¥å£**ï¼šCLI å‘½ä»¤è¡Œå·¥å…· + Web UI

## é¡¹ç›®ç»“æ„

```
orange-translator/
â”œâ”€â”€ core/                    # æ ¸å¿ƒå±‚ï¼šä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ epub/
â”‚   â”‚   â”œâ”€â”€ parser.py        # EPUB è§£åŒ…ã€spine/manifest è§£æ
â”‚   â”‚   â”œâ”€â”€ extractor.py     # HTML æ–‡æœ¬å—æå–
â”‚   â”‚   â””â”€â”€ packer.py        # åŒè¯­é‡ç»„ + EPUB æ‰“åŒ…
â”‚   â”œâ”€â”€ translator/
â”‚   â”‚   â”œâ”€â”€ base.py          # TranslatorBase æŠ½è±¡ç±»
â”‚   â”‚   â”œâ”€â”€ ollama.py        # Ollama å®ç°
â”‚   â”‚   â””â”€â”€ openai_compat.py # OpenAI å…¼å®¹æ¥å£
â”‚   â”œâ”€â”€ pipeline.py          # ç¿»è¯‘æµæ°´çº¿ï¼ˆè°ƒåº¦ã€è¿›åº¦ã€ç»­ç¿»ï¼‰
â”‚   â””â”€â”€ config.py            # é…ç½®æ¨¡å‹
â”œâ”€â”€ app/                     # åº”ç”¨å±‚ï¼šäº¤ä»˜æ–¹å¼
â”‚   â”œâ”€â”€ cli/
â”‚   â”‚   â””â”€â”€ main.py          # CLI å…¥å£ï¼ˆtyperï¼‰
â”‚   â””â”€â”€ web/
â”‚       â”œâ”€â”€ app.py           # FastAPI åç«¯
â”‚       â”œâ”€â”€ routers/
â”‚       â””â”€â”€ frontend/        # Vue 3 + Vite å‰ç«¯
â””â”€â”€ pyproject.toml
```

## å®‰è£…

ä¾èµ– [uv](https://docs.astral.sh/uv/) ç®¡ç†ç¯å¢ƒï¼ŒPython 3.12+ã€‚

```bash
git clone https://github.com/yourname/orange-translator
cd orange-translator
uv pip install -e .
```

## ä½¿ç”¨

### å‰æ

å¯åŠ¨ Ollama å¹¶æ‹‰å–é»˜è®¤æ¨¡å‹ï¼š

```bash
ollama serve
ollama pull translategemma:4b
```

### CLI

```bash
# åŸºç¡€ç”¨æ³•ï¼ˆè‹± â†’ ä¸­ï¼‰
ot translate book.epub --from en --to zh

# æŒ‡å®šæ¨¡å‹
ot translate book.epub --from en --to zh --model translategemma:12b

# æŒ‡å®šè¾“å‡ºè·¯å¾„
ot translate book.epub -o book_bilingual.epub

# ä½¿ç”¨ OpenAI å…¼å®¹å¼•æ“
ot translate book.epub --engine openai --api-key sk-... --model gpt-4o-mini

# æŸ¥çœ‹æ”¯æŒçš„è¯­è¨€
ot languages

# åˆ—å‡ºæœ¬åœ° Ollama å¯ç”¨æ¨¡å‹
ot models
```

### Web UI

```bash
# å¯åŠ¨æœåŠ¡
uv run uvicorn app.web.app:app --reload --port 8000
```

æµè§ˆå™¨è®¿é—® [http://localhost:8000](http://localhost:8000)ï¼Œä¸Šä¼  EPUB æ–‡ä»¶å¹¶é…ç½®ç¿»è¯‘å‚æ•°ï¼Œå®æ—¶æŸ¥çœ‹è¿›åº¦ï¼Œå®Œæˆåä¸‹è½½åŒè¯­ç‰ˆæœ¬ã€‚

## ç¿»è¯‘å‚æ•°

é»˜è®¤å€¼ï¼ˆ`TranslateConfig`ï¼‰ï¼š

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|
| `chapter_concurrency` | `1` | ç« èŠ‚å¹¶å‘æ•°ï¼ŒOllama æœ¬åœ°æ¨¡å‹å»ºè®®ä¿æŒ 1 |
| `batch_size` | `7` | æ¯æ‰¹æœ€å¤šæ®µè½æ•° |
| `batch_char_limit` | `3000` | æ¯æ‰¹å‰¥ç¦»åå­—ç¬¦æ•°ä¸Šé™ï¼Œè¶…è¿‡åˆ™æå‰æˆªæ–­ |
| `temperature` | `0.3` | ç¿»è¯‘æ¸©åº¦ |

## ç¼“å­˜ç›®å½•

ç¿»è¯‘è¿‡ç¨‹ä¸­åœ¨ `<epubå>.ot-cache/` ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
book.ot-cache/
â”œâ”€â”€ progress.json        # è¿›åº¦è®°å½•ï¼ŒæŒ‰å®Œæˆé¡ºåºè®°å½•æ¯ç« è€—æ—¶
â”œâ”€â”€ <md5>.xhtml          # å„ç« èŠ‚ç¿»è¯‘ç»“æœç¼“å­˜ï¼ˆå¯æ–­ç‚¹ç»­ç¿»ï¼‰
â””â”€â”€ translate.log        # æœ¬æ¬¡ç¿»è¯‘æ—¥å¿—ï¼ˆæˆåŠŸåéšç¼“å­˜ä¸€èµ·åˆ é™¤ï¼‰
```

`progress.json` æ ¼å¼ï¼š

```json
{
  "completed": [
    { "path": "text/part0001.html", "duration_sec": 0.7 },
    { "path": "text/part0004.html", "duration_sec": 45.1 }
  ]
}
```

- **å…¨éƒ¨æˆåŠŸ**ï¼šç¿»è¯‘å®Œæˆåç¼“å­˜ç›®å½•è‡ªåŠ¨åˆ é™¤
- **æœ‰ç« èŠ‚å¤±è´¥**ï¼šç¼“å­˜ç›®å½•ä¿ç•™ï¼Œé‡æ–°è¿è¡Œæ—¶è‡ªåŠ¨è·³è¿‡å·²æˆåŠŸç« èŠ‚ã€é‡ç¿»å¤±è´¥ç« èŠ‚

æŒä¹…åŒ–æ—¥å¿—ä¿å­˜åœ¨ `log/ot-translate.log`ï¼ˆè‡ªåŠ¨è½®è½¬ï¼Œä¿ç•™æœ€è¿‘ 10 ä¸ªæ–‡ä»¶ï¼‰ã€‚

## åŒè¯­æ ·å¼

è¯‘æ–‡èŠ‚ç‚¹æ ¼å¼ï¼š

```html
<p>Original paragraph.</p>
<p class="ot-translation" lang="zh">è¯‘æ–‡æ®µè½ã€‚</p>
```

- è¯‘æ–‡é»˜è®¤è“è‰²ã€å·¦è¾¹æ¡†åŒºåˆ†
- å±…ä¸­æ–‡å­—è‡ªåŠ¨ç»§æ‰¿å¯¹é½æ–¹å¼ï¼Œæ”¹ç”¨åº•éƒ¨ç»†çº¿åŒºåˆ†
- æ ·å¼é€šè¿‡æ³¨å…¥çš„ `ot-translation.css` æ§åˆ¶ï¼Œå¯è‡ªå®šä¹‰è¦†ç›–
